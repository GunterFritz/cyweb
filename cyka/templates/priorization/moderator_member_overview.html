{% block extrahead %}
{% endblock %}
{% block javascript %}
<script>
  function updateMembers(json){
    var finished = true;
    var obj = $.parseJSON(json);
    $.each(obj.member , function(index, val) {
	if(val.status){
            $( "#_member_" + val.id + "_icon").text('check');
	} else {
	    finished = false;
            $( "#_member_" + val.id + "_icon").text('remove');
	}
    });
    if(finished && !obj.project.hasagenda){
	    $("#_finish_step").removeClass("disabled");
    } else {
	    $("#_finish_step").addClass("disabled");
    }
  }
  function getMembers(){
    $.ajax({
        type: "GET",
        url: '{% url 'cyka:get_json_members' project.id %}',
	complete: function (response) {
          updateMembers(response.responseText)
      }
    });
  }
  function refreshMembers(){
    tmp = setInterval(function() {
	getMembers();
    }, 3000);
    refreshs.push(tmp);
  }
  $(document).ready(function(){
    refreshMembers();
    $('.tooltipped').tooltip({enterDelay: 1000});
  });
    function resolve(){
	if (confirm("Möchten Sie die Themen Zuteilung auflösen?")){
	    aurl('{% url 'cyka:moderator_priorization' project.id %}?function=resolve');
	}
    }
</script>
{% endblock %}
<div class="col actionarea" style="overflow: hidden">
      <div>
        <ul class="pagination center">
          <li class="waves-effect disabled"><a>Brainwriting</a></li>
          <li class="waves-effect disabled"><a>Themenvorschlag</a></li>
          <li class="waves-effect disabled"><a>Themenwahl</a></li>
          <li class="waves-effect active blue"><a>Priorisierung</a></li>
          <li class="waves-effect disabled"><a>Agenda</a></li>
        </ul>
      </div>
      <div class="row center">
        <a onmouseover="this.style.cursor='pointer'" onclick="aurl('{% url 'cyka:moderator_topicauction' project.id %}?function=table')"
		class="waves-effect waves-light btn-floating blue {% if step.status != 'O' %}disabled{% endif%}"><i class="material-icons tooltipped" data-tooltip="Schritt zurücksetzen">fast_rewind</i>
	</a>
	<a onmouseover="this.style.cursor='pointer'" onclick="submit('O','{% url 'cyka:moderator_priorization' project.id %}', '{{step.step}}')"
	     class="waves-effect waves-light btn-floating red {% if step.status == 'O' %}disabled{% endif%}">
		<i class="material-icons tooltipped" data-tooltip="Reset">replay</i>
        </a>
	<a onmouseover="this.style.cursor='pointer'" onclick="submit('S','{% url 'cyka:moderator_priorization' project.id %}', '{{step.step}}')"
	     class="waves-effect waves-light btn-floating blue {% if step.status != 'O' %}disabled{% endif%}"><i class="material-icons tooltipped" data-tooltip="Starten">play_arrow</i>
        </a>
        <a id="_finish_step" onmouseover="this.style.cursor='pointer'" onclick="submit('B','{% url 'cyka:moderator_priorization' project.id %}', '{{step.step}}')"
	     class="waves-effect waves-light btn-floating blue disabled"><i class="material-icons tooltipped" data-tooltip="Stoppen">stop</i>
        </a>
        <a id="_next_step" onmouseover="this.style.cursor='pointer'" onclick="aurl('{% url 'cyka:moderator_priorization' project.id %}?function=agenda')"
	     class="waves-effect waves-light btn-floating blue {% if step.status != 'B' or not project.hasagenda %}disabled{% endif%}"><i class="material-icons tooltipped" data-tooltip="nächster Schritt">fast_forward</i></a>
      </div>
      <div class="card">
        <div class="collection">
          {% for m in member %}
	  <a class="collection-item" id="_member_{{m.id}}" onmouseover="this.style.cursor='pointer'" onclick="aurl('{% url 'cyka:moderator_priorization' project.id %}?function=details&member={{m.id}}')"><div>
		  <span id="_member_{{m.id}}_name" class="icon-black">{{m.name}}</span>
		  <span class="secondary-content">
			  <i id="_member_{{m.id}}_icon" class="material-icons icon-text icon-blue">{% if m.status %}check{% else %}remove{% endif %}</i>
		  </span>
	  </div></a>
	  {% endfor %}
        </div>
      </div>
</div>
